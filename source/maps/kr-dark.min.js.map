{"version":3,"sources":["kr-dark.js"],"names":["rootElement","document","documentElement","darkModeStorageKey","rootElementDarkModeAttributeName","darkModeTogglebuttonElement","getElementById","getLS","k","localStorage","getItem","e","getModeFromCSSMediaQuery","window","matchMedia","matches","resetRootDarkModeAttributeAndLS","removeAttribute","removeItem","removeLS","validColorModeKeys","dark","light","applyCustomDarkModeSettings","mode","currentSetting","setAttribute","invertDarkModeObj","toggleCustomDarkMode","v","setItem","setLS","addEventListener"],"mappings":"AAOA,MAGI,MAAMA,EAAcC,SAASC,gBAEvBC,EAAqB,oBAErBC,EAAmC,yBAEnCC,EAA8BJ,SAASK,eAAe,mBA2BtDC,EAASC,IAEX,IACI,OAAOC,aAAaC,QAAQF,GAC9B,MAAOG,GAEL,OAAO,OAOTC,EAA2B,IAEtBC,OAAOC,WAAW,gCAAgCC,QAC3D,OACA,QAMIC,EAAkC,KAEpChB,EAAYiB,gBAAgBb,GApCf,CAACI,IAEd,IACIC,aAAaS,WAAWV,GAC1B,MAAOG,MAkCTQ,CAAShB,IAMPiB,EAAqB,CACvBC,MAAQ,EACRC,OAAS,GAMPC,EAA+BC,IAGjC,MAAMC,EAAiBD,GAAQjB,EAAMJ,GAEjCsB,IAAmBb,IAGnBI,IACOI,EAAmBK,GAG1BzB,EAAY0B,aAAatB,EAAkCqB,GAK3DT,KAIFW,EAAoB,CACtBN,KAAQ,QACRC,MAAS,QAMPM,EAAuB,KAEzB,IAAIH,EAAiBlB,EAAMJ,GAE3B,GAAIiB,EAAmBK,GAGnBA,EAAiBE,EAAkBF,OAChC,CAAA,GAAuB,OAAnBA,EAQhB,OAJSA,EAAiBE,EAAkBf,KAU7C,MAlHgB,EAACJ,EAAGqB,KAEd,IACIpB,aAAaqB,QAAQtB,EAAGqB,GAC1B,MAAOlB,MA4GToB,CAAM5B,EAAoBsB,GAEzBA,GAILF,IAGAlB,EAA4B2B,iBAAiB,SAAS,KAGxDT,EAA4BK,SA1I9B","file":"../js/kr-dark.min.js","sourcesContent":["/*\r\n * è¯¥éƒ¨åˆ†ä»£ç é‡‡ç”¨ CC BY-NC-SA 4.0 è®¸å¯åè®®ï¼Œè‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\r\n * ä½œè€…ï¼šSukka\r\n * æ¥æºï¼šä½ å¥½é»‘æš—ï¼Œæˆ‘çš„è€æœ‹å‹ â€”â€” ä¸ºç½‘ç«™æ·»åŠ ç”¨æˆ·å‹å¥½çš„æ·±è‰²æ¨¡å¼æ”¯æŒ | Sukka's Blog\r\n * é“¾æ¥ï¼šhttps://blog.skk.moe/post/hello-darkmode-my-old-friend/\r\n */\r\n\r\n(() => {\r\n\t\r\n\t// <html></html>\r\n    const rootElement = document.documentElement;\r\n\t// ä½œä¸º localStorage çš„ key\r\n    const darkModeStorageKey = 'user-color-scheme';\r\n\t// æ·±è‰²æ¨¡å¼å±æ€§åç§°\r\n    const rootElementDarkModeAttributeName = 'data-user-color-scheme';\r\n\t// æ·±è‰²æ¨¡å¼åˆ‡æ¢æŒ‰é’®\r\n    const darkModeTogglebuttonElement = document.getElementById('darkmode-switch');\r\n\r\n\t/**\r\n\t * è®¾ç½® LocalStorage çš„æŒ‡å®šå±æ€§\r\n\t */\r\n    const setLS = (k, v) => {\r\n\t\t\r\n        try {\r\n            localStorage.setItem(k, v);\r\n        } catch (e) {\r\n\t\t\t// (æ­¤å¤„ä¸è¿›è¡Œå¤„ç†)\r\n\t\t}\r\n    };\r\n\t/**\r\n\t * ç§»é™¤ LocalStorage çš„æŒ‡å®šå±æ€§\r\n\t */\r\n    const removeLS = (k) => {\r\n\t\t\r\n        try {\r\n            localStorage.removeItem(k);\r\n        } catch (e) {\r\n\t\t\t// (æ­¤å¤„ä¸è¿›è¡Œå¤„ç†)\r\n\t\t}\r\n    };\r\n\t/**\r\n\t * è·å– LocalStorage çš„æŒ‡å®šå±æ€§\r\n\t */\r\n    const getLS = (k) => {\r\n\t\t\r\n        try {\r\n            return localStorage.getItem(k);\r\n        } catch (e) {\r\n\t\t\t// ä¸ localStorage ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº” key çš„è¡Œä¸ºä¸€è‡´\r\n            return null;\r\n        }\r\n    };\r\n\t\r\n\t/**\r\n\t * è·å–å½“å‰ç”Ÿæ•ˆçš„æ˜¾ç¤ºæ¨¡å¼ï¼ˆæ·±è‰²/æµ…è‰²ï¼‰åç§°\r\n\t */\r\n    const getModeFromCSSMediaQuery = () => {\r\n\t\t\r\n        return window.matchMedia('(prefers-color-scheme: dark)').matches \r\n\t\t\t\t? 'dark' \r\n\t\t\t\t: 'light'\r\n    };\r\n\t\r\n\t/**\r\n\t * åˆå§‹åŒ– DOMæ ¹èŠ‚ç‚¹ ä»¥åŠ LocalStorage çš„æ˜¾ç¤ºæ¨¡å¼å¯¹åº”çš„å±æ€§\r\n\t */\r\n    const resetRootDarkModeAttributeAndLS = () => {\r\n\t\t\r\n        rootElement.removeAttribute(rootElementDarkModeAttributeName);\r\n\t\t\r\n        removeLS(darkModeStorageKey);\r\n    };\r\n\r\n\t/**\r\n\t * æ ¡éªŒkey\r\n\t */\r\n    const validColorModeKeys = {\r\n        'dark': true,\r\n        'light': true\r\n    };\r\n    \r\n\t/**\r\n\t * æäº¤æŒ‡å®šçš„æ·±è‰²/æµ…è‰²æ˜¾ç¤ºæ¨¡å¼çš„è®¾ç½®\r\n\t */\r\n    const applyCustomDarkModeSettings = (mode) => {\r\n\t\t\r\n        // æ¥å—ä»ã€Œå¼€å…³ã€å¤„ä¼ æ¥çš„æ¨¡å¼ï¼Œæˆ–è€…ä» localStorage è¯»å–\r\n        const currentSetting = mode || getLS(darkModeStorageKey);\r\n\t\t\r\n        if (currentSetting === getModeFromCSSMediaQuery()) {\r\n            // å½“ç”¨æˆ·è‡ªå®šä¹‰çš„æ˜¾ç¤ºæ¨¡å¼å’Œ prefers-color-scheme ç›¸åŒæ—¶é‡ç½®ï¼Œæ¢å¤åˆ°è‡ªåŠ¨æ¨¡å¼\r\n\t\t\t\r\n            resetRootDarkModeAttributeAndLS();\r\n        } else if (validColorModeKeys[currentSetting]) {\r\n\t\t\t// (ç›¸æ¯” <code>Array#indexOf</code>ï¼Œè¿™ç§å†™æ³• Uglify åå­—èŠ‚æ•°æ›´å°‘)\r\n\t\t\t\r\n            rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);\r\n        } else {\r\n            // é¦–æ¬¡è®¿é—®æˆ–ä»æœªä½¿ç”¨è¿‡å¼€å…³ã€localStorage ä¸­æ²¡æœ‰å­˜å‚¨çš„å€¼ï¼ŒcurrentSetting æ˜¯ <code>null</code>\r\n            //â¤· æˆ–è€… localStorage è¢«ç¯¡æ”¹ï¼ŒcurrentSetting ä¸æ˜¯åˆæ³•å€¼\r\n\t\t\t\r\n            resetRootDarkModeAttributeAndLS();\r\n        }\r\n    };\r\n\r\n    const invertDarkModeObj = {\r\n        'dark': 'light',\r\n        'light': 'dark'\r\n    };\r\n    \r\n\t/**\r\n\t * åˆ‡æ¢æ˜¾ç¤ºæ¨¡å¼ï¼ˆæ·±è‰²/æµ…è‰²ï¼‰\r\n\t */\r\n    const toggleCustomDarkMode = () => {\r\n\t\t\r\n        let currentSetting = getLS(darkModeStorageKey);\r\n        \r\n        if (validColorModeKeys[currentSetting]) {\r\n\t\t\t\r\n            // ä» localStorage ä¸­è¯»å–æ¨¡å¼ï¼Œå¹¶å–ç›¸åçš„æ¨¡å¼\r\n            currentSetting = invertDarkModeObj[currentSetting];\r\n        } else if (currentSetting === null) {\r\n            // localStorage ä¸­æ²¡æœ‰ç›¸å…³å€¼ï¼Œæˆ–è€… localStorage æŠ›äº† Error\r\n            //â¤· ä» CSS ä¸­è¯»å–å½“å‰ prefers-color-scheme å¹¶å–ç›¸åçš„æ¨¡å¼\r\n\t\t\t\r\n            currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];\r\n        } else {\r\n            // localStorage ä¸­çš„å¯¹åº”å±æ€§ğŸ¡„éé¢„æœŸå¼‚å¸¸æƒ…å†µ\r\n\t\t\t\r\n\t\t\treturn;\r\n        }\r\n\t\t\r\n        // å°†ç›¸åçš„æ¨¡å¼å†™å…¥ localStorage\r\n        setLS(darkModeStorageKey, currentSetting);\r\n\t\t\r\n\t\treturn currentSetting;\r\n    };\r\n\r\n    // å½“é¡µé¢åŠ è½½æ—¶ï¼Œå°†æ˜¾ç¤ºæ¨¡å¼è®¾ç½®ä¸º localStorage ä¸­è‡ªå®šä¹‰çš„å€¼ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰\r\n    applyCustomDarkModeSettings();\r\n\r\n\t// æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢æŒ‰é’®ğŸ¡„æ·»åŠ äº‹ä»¶ç›‘å¬\r\n    darkModeTogglebuttonElement.addEventListener('click', () => {\r\n\t\t// å½“ç”¨æˆ·ç‚¹å‡»ã€Œå¼€å…³ã€æ—¶ï¼Œè·å¾—æ–°çš„æ˜¾ç¤ºæ¨¡å¼ï¼Œå†™å…¥ localStorageï¼Œå¹¶åœ¨é¡µé¢ä¸Šç”Ÿæ•ˆ\r\n\t\t\r\n\t\tapplyCustomDarkModeSettings(toggleCustomDarkMode());\r\n    });\r\n})();\r\n"]}